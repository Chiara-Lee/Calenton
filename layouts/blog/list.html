{{define "bodyClass"}} page {{end}}
{{ define "body" }}
<main>
    <h1 class="page-title">{{ .Title | default "Untitled Page" }}</h1>
    
    {{ $paginator := .Paginate .Pages }}
    
    <section id="posts">
        <p class="post-count">Number of pages found: {{ $paginator.TotalPages }}</p>
        <div class="post-container">
            {{ range $paginator.Pages }}
            <div class="post-card"> <!-- 确保每篇文章都有独立的 .post-card -->
                <h2>{{ .Title }}</h2>

                <div class="post-meta">
                    <span><i class="icon-calendar"></i> 创建于{{ .Date.Format "2006-01-02" }}</span>
                    <span><i class="icon-edit"></i> 更新于{{ .Lastmod.Format "2006年01月02日" }}</span>
                
                    {{- if .IsPage }}
                        <!-- 如果是单一页面，显示当前文章的字数和阅读时长 -->
                        <span><i class="icon-time"></i> 预计阅读{{ .ReadingTime }}分钟</span>
                        <span><i class="icon-text-width"></i> 全文约{{ .WordCount }}字</span>
                    {{- else }}
                        <!-- 如果是列表页面，统计所有子页面的字数和阅读时长 -->
                        {{ $totalReadingTime := 0 }}
                        {{ $totalWordCount := 0 }}
                        
                        {{- range .Pages }}
                            {{- if .IsPage }}
                                <!-- 如果是单页面，直接获取字数和阅读时长 -->
                                {{ $currentPageReadingTime := .ReadingTime }}
                                {{ $currentPageWordCount := .WordCount }}
                                {{ $totalReadingTime = add $totalReadingTime $currentPageReadingTime }}
                                {{ $totalWordCount = add $totalWordCount $currentPageWordCount }}
                            {{- else }}
                                <!-- 如果是列表页面，尝试从其 front matter 获取统计值 -->
                                {{ $subPageTotalReadingTime := .Params.totalReadingTime | default 0 }}
                                {{ $subPageTotalWordCount := .Params.totalWordCount | default 0 }}
                        
                                <!-- 如果列表页没有统计值，递归遍历其子页面 -->
                                {{ if eq $subPageTotalReadingTime 0 }}
                                    {{ $subPageTotalReadingTime = 0 }}
                                    {{ $subPageTotalWordCount = 0 }}
                        
                                    {{- range .Pages }}
                                        {{- if .IsPage }}
                                            {{ $subPageTotalReadingTime = add $subPageTotalReadingTime .ReadingTime }}
                                            {{ $subPageTotalWordCount = add $subPageTotalWordCount .WordCount }}
                                        {{- else }}
                                            {{ $nestedReadingTime := .Params.totalReadingTime | default 0 }}
                                            {{ $nestedWordCount := .Params.totalWordCount | default 0 }}
                                            {{ $subPageTotalReadingTime = add $subPageTotalReadingTime $nestedReadingTime }}
                                            {{ $subPageTotalWordCount = add $subPageTotalWordCount $nestedWordCount }}
                                        {{- end }}
                                    {{- end }}
                                {{ end }}
                        
                                <!-- 将子页面的统计值累加到当前页面 -->
                                {{ $totalReadingTime = add $totalReadingTime $subPageTotalReadingTime }}
                                {{ $totalWordCount = add $totalWordCount $subPageTotalWordCount }}
                            {{- end }}
                        {{- end }}
                        
                        <!-- 将统计结果存储到当前页面的 Scratch 中 -->
                        {{ .Scratch.Set "totalReadingTime_parent" $totalReadingTime | default 0 }}
                        {{ .Scratch.Set "totalWordCount_parent" $totalWordCount | default 0 }}
                        
                        <!-- 页面显示统计结果 -->
                        <span><i class="icon-time"></i> 预计阅读总时长 {{ .Scratch.Get "totalReadingTime_parent" }} 分钟</span>
                        <span><i class="icon-text-width"></i> 总字数约 {{ .Scratch.Get "totalWordCount_parent" }} 字</span>
                                                  
                    {{- end }}
                </div>        
                <p>{{ .Summary | plainify | truncate 100 "..." }}</p>
                <a href="{{ .Permalink }}" class="read-more">→ 进来看看</a>
                <div class="tags">
                    {{ range .Params.tags }}
                        <span class="tag">#{{ . }}</span>
                    {{ end }}
                </div>
            </div>
            {{ end }}
        </div>
    </section>

    {{ if gt $paginator.TotalPages 1 }}
    <nav class="pagination">
        {{ if $paginator.HasPrev }}
            <a class="prev" href="{{ $paginator.Prev.URL }}">Previous</a>
        {{ end }}
        {{ range $paginator.Pagers }}
            <a href="{{ .URL }}" class="{{ if eq .PageNumber $paginator.PageNumber }}current{{ end }}">{{ .PageNumber }}</a>
        {{ end }}
        {{ if $paginator.HasNext }}
            <a class="next" href="{{ $paginator.Next.URL }}">Next</a>
        {{ end }}
    </nav>
    {{ end }}
</main>
<script src="/js/bundle.js"></script>
{{ end }}
