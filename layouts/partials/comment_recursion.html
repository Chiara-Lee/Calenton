<div class="comment" style="margin-left: {{ mul .comment.data.depth 20 }}px !important;">
    {{ printf "Current Depth: %d" .comment.data.depth }}
  <img src="https://www.gravatar.com/avatar/{{ md5 .comment.data.email }}?s=100&d=wavatar" alt="{{ .comment.data.name }} Avatar">
  <div class="author">{{ .comment.data.name }}</div>
  <div class="message">{{ .comment.data.comment }}</div>
  <button class="reply-button" data-parent="{{ .comment.data.parent }}" data-name="{{ .comment.data.name }}">Reply (Parent ID: {{ .comment.data.parent }})</button>
  <span class="time">{{ .comment.data.time }}</span>

  {{ if lt .Depth 2 }} <!-- 设置嵌套层级限制 -->
  <div class="replies">
      <!-- 过滤掉顶级评论，创建一个只包含子评论的集合 -->
      {{ $filteredComments := slice }}
      {{ range $.comments }}
          {{ if .parent }} <!-- 如果 parent 字段不为空 -->
              {{ $filteredComments = $filteredComments | append . }}
          {{ end }}
      {{ end }}
      <!-- 筛选属于当前评论的子评论 -->
      {{ $currentReplies := where $filteredComments "parent" .comment.data.custom }}
      
      {{ range $currentReplies }}
      {{ $reply := . }}
              {{ $newDepth := add (int .comment.data.depth) 1 }}

              {{ $replyData := dict 
                "custom" (default (print "custom-" now.UnixNano) $reply.data.custom)
                "parent" (default "" $reply.data.parent)
                "name" (default "" $reply.data.name)
                "email" (default "" $reply.data.email)
                "comment" (default "" $reply.data.comment)
                "time" (default "" $reply.data.time)
                "Depth" $newDepth
            }}
              {{ partial "comment_recursion.html" (dict "comment" $replyData "comments" $.comments) }}
          {{ end }}
  </div>
  {{ end }}
  
</div>

  