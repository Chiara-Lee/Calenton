<div class="comment" style="margin-left: {{ mul .Depth 20 }}px !important;">
  <img src="https://www.gravatar.com/avatar/{{ md5 .comment.email }}?s=100&d=wavatar" alt="{{ .comment.name }} Avatar">
  <div class="author">{{ .comment.name }}</div>
  <div class="message">{{ .comment.comment }}</div>
  <button class="reply-button" data-parent="{{ .comment.parent }}" data-name="{{ .comment.name }}">Reply (Parent ID: {{ .comment.parent }})</button>
  <span class="time">{{ .time }}</span>

  {{ if lt .Depth 2 }} <!-- 设置嵌套层级限制 -->
  <div class="replies">
    <!-- 为每个评论的 parent 字段设置默认值 -->
    {{ $comments := slice }}
    {{ range $.comments }}
        {{ $comment := dict 
            "custom" .custom
            "parent" (default "" .parent)
            "name" .name
            "email" .email
            "comment" .comment
            "time" .time
        }}
        {{ $comments = $comments | append $comment }}
    {{ end }}
      <!-- 筛选属于当前评论的子评论 -->
      {{ $currentReplies := where $.comments "parent" .comment.custom }}
      
      {{ range $index, $reply := $currentReplies }}
          {{ $replyParentId := default "" $reply.data.parent }}
              {{ $replyData := dict 
                  "custom" (default (print "custom-" now.UnixNano) $reply.data.custom)
                  "parent" (default "" $reply.data.parent)
                  "name" (default "" $reply.data.name)
                  "email" (default "" $reply.data.email)
                  "comment" (default "" $reply.data.comment)
                  "time" (default "" $reply.data.time)
              }}
              {{ partial "comment_recursion.html" (dict "comment" $reply "Depth" (add .Depth 1) "comments" $.comments) }}
          {{ end }}
  </div>
  {{ end }}
  
</div>

  